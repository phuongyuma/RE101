## ANALYSIS REPORT

Analyze a malware (WannaCry) behaviors in both static and dynamic way. 

-------
### Set up enviroment

We need an safe virtualized environment for malware analysis.
Here are some general guidelines to follow when setting up a malware analysis environment:
1. Isolation: It is essential to keep the malware isolated from the rest of your network and systems. This can be achieved by using a separate, dedicated analysis machine or virtual environment.
2. Sandboxing: Use a sandboxed environment in which the malware can be safely executed. This can be a physical or virtualized environment that is isolated from the rest of your network.
3. Monitoring: Use monitoring tools, such as a network sniffer or host-based intrusion detection system, to capture and analyze network traffic, system calls, and other activity to observe the malware's behavior.
4. Backups: Make sure you have current backups of your systems and data before you begin your analysis. This will allow you to restore your systems to a known good state if the malware causes damage or if you need to revert changes made during the analysis.
5. Security controls: Ensure that your security controls, such as firewalls and intrusion detection/prevention systems, are in place and configured to block any suspicious activity or network traffic.
6. Access controls: Limit the number of people who have access to the analysis environment and monitor all access to the environment.
7. Disposal : Proper disposal of the malware samples and all associated files after the analysis is done.
8. Document : Keep a detailed and accurate record of all steps taken during the analysis, including the software and tools used, the results of the analysis, and any remediation steps taken.

I use **FLARE VM** on **VMware** and set NIC of this virtual machine to **host-only**, and disconnect it when I am executing the malware. (Since this is my first exposure to malware, I will try to do it carefully)

Before do something with malware, I take a snapshot of the machine to backups.

---
### Static Analysis

Analyze the malware without executing it. This can be done by examining the code, data, and resources in the sample to see if it contains any obvious indicators of malicious behavior

Some general steps:
1.  File analysis: Analyze the file properties, such as the file size, the file type, the file name, and the file creation and modification dates.
2.  File header analysis: Analyze the file header of the malware to identify the file format and possible packer used.
3.  Signature-based detection: Compare the code or data structure with known malware samples using signature-based detection tools such as VirusTotal, Hybrid-Analysis, etc.
4.  File unpacking: Unpack the malware sample if it is packed or obfuscated, which can be done by using tools such as UPX, Themida, or other unpacker.
5.  File disassembly: Disassemble the malware sample using a disassembler such as IDA Pro, Ghidra, etc. to see the assembly code.
6.  File Decompilation: Decompile the malware sample using a Decompiler such as Hex-Rays, RetDec, etc. to see the source code.
7.  Strings analysis: Extract and analyze the strings in the malware sample. This can reveal information such as file paths, IP addresses, and other data that may be useful in understanding the malware's behavior.
8.  Dependency analysis: Use a tool such as Dependency Walker to analyze the dependencies of the malware. This can help you understand which other libraries or DLLs are required by the malware.

==CFF Explorer== is a tool that allows you to view and edit the structure and content of PE files, including the headers, sections, resources, and import/export tables.

Use ==CFF Explorer== to get an overview about this file like: file type, hash, file size, libary, function import, PE header
![[Pasted image 20230113170525.png]]
![[Pasted image 20230113170650.png]]

Use ==CyberChef== or ==HashCalc== to find hashing of malware
![[Pasted image 20230113170951.png]]

==Detect it easy== can be used to extract information such as the file properties, imports, exports, and other data that can be used to identify the malware and its behavior. The tool can also be used to detect packers and crypters
![[Pasted image 20230113171236.png]]

We can see section **.rdata** and **.rsrc** has been packed
![[Pasted image 20230113171251.png]]

We can use ==DIE== to find some **Strings** useful, susch as name of some function
![[Pasted image 20230113171631.png]]